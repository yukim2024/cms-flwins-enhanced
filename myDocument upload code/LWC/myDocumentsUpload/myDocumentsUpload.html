<template>
    <!-- Preview File Modal -->
    <template if:true={showFilePreviewModal}>
        <div class="slds-backdrop slds-backdrop_open"></div>
        <section
        role="dialog"
        tabindex="0"
        aria-labelledby="modal-heading-01"
        aria-modal="true"
        aria-describedby="modal-content-id-1"
        class="slds-modal slds-fade-in-open"
        >
        <div class="file-preview-modal-container slds-modal__container">
            <header class="slds-modal__header">
            <lightning-button-icon
                class="slds-modal__close"
                title="Close"
                icon-name="utility:close"
                icon-class="slds-button_icon-inverse"
                onclick={closeFilePreviewModal}
            ></lightning-button-icon>
    
            <h4 id="modal-heading-01" class="slds-text-heading_large">
                {modalFile.Title}
            </h4>
            </header>
            <div class="slds-modal__content" id="modal-content-id-1" style="width:100%;">
                <template for:each={imgUrls} for:item="imgUrl">
                    <img key={imgUrl.pageNumber} onload={handleImgLoad} onerror={handleImageError} src={imgUrl.url} />
                </template>
                
                <template if:true={showImgErrorMessage}>
                    <p class="no-preview-error">{label.NO_PREVIEW_ERROR_LABEL}</p>
                </template>
            </div>
            <footer class="slds-modal__footer slds-grid slds-grid_align-spread">
            <lightning-button
                variant="neutral"
                label={label.CANCEL_LABEL}
                onclick={closeFilePreviewModal}
                title={label.CANCEL_LABEL}
                class="slds-var-m-left_x-small"
            ></lightning-button>
            <a href={modalFile.DownloadUrl}>
                <lightning-button 
                    label={label.DOWNLOAD_LABEL}
                    title={label.DOWNLOAD_LABEL}
                    icon-name="utility:download" 
                    class="slds-m-left_x-small">
                </lightning-button>
            </a>
            </footer>
        </div>
        </section>
    </template>

    <!-- Delete File Modal -->
    <template if:true={showDeleteFileModal}>
        <div class="slds-backdrop slds-backdrop_open"></div>
        <section
            role="dialog"
            tabindex="0"
            aria-labelledby="modal-heading-02"
            aria-modal="true"
            aria-describedby="modal-content-id-2"
            class="slds-modal slds-fade-in-open"
        >
        <div class="slds-modal__container">
            <header class="slds-modal__header">
            <lightning-button-icon
                class="slds-modal__close"
                title="Close"
                icon-name="utility:close"
                icon-class="slds-button_icon-inverse"
                onclick={closeDeleteFileModal}
            ></lightning-button-icon>
    
            <h4 id="modal-heading-02" class="slds-text-heading_large">
                {label.DELETE_TITLE_LABEL}
            </h4>
            </header>
            <div class="slds-modal__content" id="modal-content-id-2" style="width:100%;">
                <p class="delete-file-modal-content">{label.DELETE_MODAL_CONTENT_LABEL}</p>
            </div>
            <footer class="slds-modal__footer slds-grid slds-grid_align-spread">
            <lightning-button
                variant="neutral"
                label={label.CANCEL_LABEL}
                onclick={closeDeleteFileModal}
                title={label.CANCEL_LABEL}
                class="slds-var-m-left_x-small"
            ></lightning-button>
            <lightning-button 
                label={label.CONFIRM_LABEL}
                title={label.CONFIRM_LABEL}
                onclick={deleteFile}
                class="slds-m-left_x-small"
                disabled={currentlyDeletingFile}>
            </lightning-button>
            </footer>
        </div>
        </section>
    </template>

    <div class="header-container">
        <h1>
            {label.MY_DOCUMENTS_LABEL}
        </h1>
    </div>

    <div class="file-upload-container">

        <template if:true={isLoading}>
            <lightning-spinner alternative-text="Loading" variant="brand" size="large"></lightning-spinner>
        </template>

        <lightning-layout pull-to-boundary="medium">
            <lightning-layout-item flexibility="auto" padding="horizontal-medium">

                <span class="file-upload-mobile">
                    <p>{label.FILE_SIZE_LIMIT_LABEL} {label.FILE_TYPES_LABEL}</p>
                </span>
                <span class="file-upload-desktop">
                    <p>{label.FILE_SIZE_LIMIT_LABEL}</p>
                    <p>{label.FILE_TYPES_LABEL}</p>
                </span>

            </lightning-layout-item>
            <lightning-layout-item flexibility="auto" padding="horizontal-medium"> 
                <!--
                <c-my-documents-file-uploader onfileuploadevent={fetchDocuments}></c-my-documents-file-uploader>
                -->
                <c-navigate-document-upload></c-navigate-document-upload>
            </lightning-layout-item>
        </lightning-layout>

    </div>
    <template if:false={showNoResults}>
        <table aria-label={label.MY_DOCUMENTS_LABEL}>
            <thead>
                <th>{label.TITLE_LABEL}</th>
                <th>{label.LAST_MODIFIED_LABEL}</th>
                <th  class="visually-hidden">{label.DOCUMENT_ACTIONS_LABEL}</th>
            </thead>
            <tbody>
                <template for:each={userDocuments} for:item="document">
                    <tr key={document.Id}>
                        <td>
                            <a tabindex="0" class="document-title" data-id={document.Id} onkeypress={previewFileIfEnter} onclick={previewFile}>
                                {document.Title}
                            </a>
                        </td>
                        <td>
                            <lightning-formatted-date-time value={document.LastModifiedDate} year="numeric" month="numeric" day="numeric" hour="2-digit"
                                            minute="2-digit"></lightning-formatted-date-time>
                        </td>

                        <td class="button-menu-container"> 
                            <lightning-button-menu menu-alignment="auto" class="table-button-menu" alternative-text="Show menu" variant="border-filled">
                                <lightning-menu-item value={document.Id} onclick={downloadDocument} label={label.DOWNLOAD_LABEL}></lightning-menu-item>
                                <lightning-menu-item value={document.Id} onclick={openDeleteFileModal} label={label.DELETE_LABEL}></lightning-menu-item>
                            </lightning-button-menu>
                        </td>
                    </tr>
                </template>
            </tbody>
        </table>
    </template>

    <template if:true={showNoResults}>
        <div class="no-results-container">
            <img alt="" src={noResultsImageUrl} />
            <p>{label.NO_RESULTS_LABEL}</p>
        </div>
    </template>

    
    
</template>